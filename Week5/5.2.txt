db.zips.aggregate([{$match:{$or:[{state:"CA"},{state:"NY"}]}},{$group:{_id:"$city", totalPop:{$sum:"$pop"}}},{$match:{totalPop:{$gt:25000}}},{$group:{_id:null, avgPop:{$avg:"$totalPop"}}},{$project:{_id:0, AveragePopulation:"$avgPop"}}])